<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tf_1.8_xla_doc: xla::CopyInsertion Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tf_1.8_xla_doc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d3/dbc/namespacexla.html">xla</a></li><li class="navelem"><a class="el" href="../../de/d53/classxla_1_1CopyInsertion.html">CopyInsertion</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="../../d8/dbd/classxla_1_1CopyInsertion-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">xla::CopyInsertion Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d8/d94/copy__insertion_8h_source.html">copy_insertion.h</a>&gt;</code></p>

<p>Inherits HloPassInterface.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3f2c92fc482ae2f9e7ef5e0c270709b8"><td class="memItemLeft" align="right" valign="top">StatusOr&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d53/classxla_1_1CopyInsertion.html#a3f2c92fc482ae2f9e7ef5e0c270709b8">Run</a> (<a class="el" href="../../d7/d10/classxla_1_1HloModule.html">HloModule</a> *module) override</td></tr>
<tr class="memdesc:a3f2c92fc482ae2f9e7ef5e0c270709b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the pass on the given module.  <a href="#a3f2c92fc482ae2f9e7ef5e0c270709b8">More...</a><br /></td></tr>
<tr class="separator:a3f2c92fc482ae2f9e7ef5e0c270709b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:abf6d4cb30686483553af178db690ebe7"><td class="memItemLeft" align="right" valign="top">static StatusOr&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d53/classxla_1_1CopyInsertion.html#abf6d4cb30686483553af178db690ebe7">AddCopiesForBufferAssignment</a> (<a class="el" href="../../d7/d10/classxla_1_1HloModule.html">HloModule</a> *module)</td></tr>
<tr class="separator:abf6d4cb30686483553af178db690ebe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Google docs: </p><blockquote class="doxtable">
<p>Copy insertion is a legalization HLO pass which inserts copies (kCopy instructions) to eliminate several kinds of problems in the HLO module.</p>
<p>(1) Entry parameter or a constant live out of the entry computation. Entry computation arguments and constants have different lifetimes than the computation result and cannot share the same allocation. Parameters and constants live out of non-entry computations do not need copies.</p>
<p>(2) Different values which are simultaneously live and which must be held in the same buffer. This can occur in while bodies. Specifically, the while loop state (the arguments to the while instruction) is updated in-place and the update may clobber the value from the previous iteration before the previous value is dead. Computations called from kCall instructions do not need such copies because kCall has no update in-place semantics.</p>
<p>(3) The buffer set of the root instruction of the entry computation must be unambiguous and distinct. That is, InstructionAliasSet::IsAmbiguous and InstructionAliasSet::IsDistinct return true.</p>
</blockquote>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="abf6d4cb30686483553af178db690ebe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf6d4cb30686483553af178db690ebe7">&#9670;&nbsp;</a></span>AddCopiesForBufferAssignment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">StatusOr&lt; bool &gt; xla::CopyInsertion::AddCopiesForBufferAssignment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/d10/classxla_1_1HloModule.html">HloModule</a> *&#160;</td>
          <td class="paramname"><em>module</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Google docs:</p>
<blockquote class="doxtable">
<p>The CPU and GPU backend need additional copies added due to deficiencies in buffer assignment. Specifically, copies are needed for constants live-out of computations, and for values which are live-in and live-out of the same computation. These copies are needed because buffer-assignment uses a computation-scoped analyis (<a class="el" href="../../da/daf/classxla_1_1TuplePointsToAnalysis.html">TuplePointsToAnalysis</a>) and has limited visibility across computation boundaries. This method adds these necessary copies. Returns whether the module was modified.</p>
<p>TODO(b/62548313): Remove this when buffer assignment is module-scoped.</p>
</blockquote>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../de/d53/classxla_1_1CopyInsertion_abf6d4cb30686483553af178db690ebe7_icgraph.svg" width="491" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3f2c92fc482ae2f9e7ef5e0c270709b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f2c92fc482ae2f9e7ef5e0c270709b8">&#9670;&nbsp;</a></span>Run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">StatusOr&lt; bool &gt; xla::CopyInsertion::Run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/d10/classxla_1_1HloModule.html">HloModule</a> *&#160;</td>
          <td class="paramname"><em>module</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Run the pass on the given module. </p>
<p>Returns whether the module was changed (copies were inserted). </p>
<p><br />
 Google docs: </p><blockquote class="doxtable">
<p>Copy insertion is performed in three steps:</p>
<p>(1) Add copies conservatively to guarantee that there is no live-range interference. This is done simplistically and usually results in more copies than is strictly necessary.</p>
<p>(2) Using a more fine-grained analysis, remove as many copies that were added in (1) as possible while ensuring no live-range interference.</p>
<p>(3) Add copies to resolve issues not related to live range interference such as parameters and constants live out of the entry computation.</p>
<p>We add copies then remove them (step (1) then (2)) rather than simply adding only the copies that are necessary because, in general, it is difficult to figure out the minimal set of copies to add once there is interference. On the other hand, it is easy to determine if removing a copy will introduce interference.</p>
<p>The final copy insertion in (3) is done separately to simplify the implementation of copy removal in (2) which is the most complicated part of the pass. As is, copy removal only has to reason about live range interference. If all copies were added in step (1) then copy removal would also have to reason about things like constants and parameters live out of the computation. </p>
</blockquote>
<ol type="1">
<li>Save the original kCopy because they have special usage and will not be removed later.</li>
<li>Call <code><a class="el" href="../../de/d2f/namespacexla_1_1anonymous__namespace_02copy__insertion_8cc_03.html#a85b40bcd4f85116cdffd99ed28fda246">xla::anonymous_namespace{copy_insertion.cc}::AddCopiesToResolveInterference()</a></code></li>
<li>Use <code><a class="el" href="../../dd/de3/classxla_1_1TupleSimplifier.html">xla::TupleSimplifier</a></code> for structures done by deep copies</li>
<li>Run DCE to remove the dead Tuple/GTE generated by tuple simplification</li>
<li>Run `xla::anonymous_namespace{copy_insertion.cc}::RemoveUnnecessaryCopies</li>
</ol>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../de/d53/classxla_1_1CopyInsertion_a3f2c92fc482ae2f9e7ef5e0c270709b8_icgraph.svg" width="428" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>tensorflow/tensorflow/compiler/xla/service/<a class="el" href="../../d8/d94/copy__insertion_8h_source.html">copy_insertion.h</a></li>
<li>tensorflow/tensorflow/compiler/xla/service/<a class="el" href="../../d9/d53/copy__insertion_8cc.html">copy_insertion.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
